#if defined(macintosh)
#include <types.h>
#else
#include <sys/types.h>
#endif
#if defined(unix)
#include <sys/time.h>
#else
#include <time.h>
#endif
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <limits.h>
#include "merc.h"
#include "interp.h"
#include "languages.h"
#include "magic.h"
#include "recycle.h"
#include "dictionary.h"

#if defined(WIN32)
  #define random() rand()
#endif  

char	lang_spoken[MAX_STRING_LENGTH];
char	lang_out[MAX_STRING_LENGTH];
char	lstr_out[MAX_STRING_LENGTH];

int	lang_pair_data[MAX_LANGUAGE][MAX_LPAIRS];
int	lang_trip_data[MAX_LANGUAGE][MAX_LTRIPS];
 
DICTIONARY_DATA	*	lang_dict[MAX_LANGUAGE];

const	char		vowel_table[6] =
{
    'a', 'e', 'i', 'o', 'u', 'y'
};

const	char		consonant_table[21] =
{
    'b', 'c', 'd', 'f', 'g', 'h', 'j', 'k', 'l', 'm', 'n', 'p', 'q', 'r',
    's', 't','v', 'w', 'x', 'y', 'z'
};

const	struct	language_type	lang_data[MAX_LANGUAGE] =
{
  {  "common",    &gsn_language_common,	FALSE,	FALSE,
{ { "-",NULL },
  { "+-","-+",NULL },
  { "-++","+-+","++-","+--",NULL },
  { "+-+-","++-+","+-++","-+-+",NULL },
  { "++--+","-++-+","+-+-+","++-+-","+--++","++-++","+-++-","--+++",NULL },
  { "+-++-+","-+--+-","+-+++-","+--++-","-+--++","++-+-+","+--+++",NULL },
  { "+-++-++","+-+++-+","++-+-++","+-++-+-","+-+-+-+","+--+-++","+--++-+","-++-++-",NULL },
  { "+-+++-++","++-+-++-","+-+++-+-","+-+-++-+","++-++-++","+-++-++-","+-++-+-+","+-+-+--+",NULL } },
{ { "an", 14},{ "in", 14},{ "on", 14},{ "er", 12},{ "he", 12},{ "re", 12},{ "th", 12},
  { "is", 10},{ "ou", 10},{ "ha", 9 },{ "nd", 8 },{ "pl", 8 },{ "se", 8 },{ "to", 8 },{ "ar", 7 },
  { "en", 7 },{ "or", 7 },{ "at", 6 },{ "le", 6 },{ "ne", 6 },{ "ng", 6 },{ "te", 6 },{ "ve", 6 },
  { "ac", 5 },{ "ay", 5 },{ "be", 5 },{ "ch", 5 },{ "et", 5 },{ "fo", 5 },{ "la", 5 },{ "nt", 5 },
  { "ra", 5 },{ "ro", 5 },{ "st", 5 },{ "ti", 5 },{ "yo", 5 },{ "as", 4 },{ "ed", 4 },{ "hi", 4 },
  { "il", 4 },{ "it", 4 },{ "ur", 4 },{ "wh", 4 },{ "wi", 4 },{ "av", 3 },{ "ce", 3 },{ "ct", 3 },
  { "de", 3 },{ "eo", 3 },{ "ev", 3 },{ "ew", 3 },{ "gh", 3 },{ "gr", 3 },{ "ho", 3 },{ "ht", 3 },
  { "if", 3 },{ "ig", 3 },{ "li", 3 },{ "ll", 3 },{ "ma", 3 },{ "me", 3 },{ "of", 3 },{ "op", 3 },
  { "pe", 3 },{ "ai", 2 },{ "ak", 2 },{ "al", 2 },{ "ca", 2 },{ "ea", 2 },{ "ee", 2 },{ "ei", 2 },
  { "el", 2 },{ "es", 2 },{ "fe", 2 },{ "fi", 2 },{ "ga", 2 },{ "ge", 2 },{ "io", 2 },{ "ld", 2 },
  { "ly", 2 },{ "mi", 2 },{ "my", 2 },{ "nc", 2 },{ "nl", 2 },{ "ns", 2 },{ "ny", 2 },{ "po", 2 },
  { "ri", 2 },{ "rp", 2 },{ "rr", 2 },{ "rs", 2 },{ "so", 2 },{ "ts", 2 },{ "ul", 2 },{ "un", 2 },
  { "up", 2 },{ "ut", 2 },{ "wa", 2 },{ "ys", 2 },{ "ad", 1 },{ "ag", 1 },{ "am", 1 },{ "ba", 1 },
  { "bi", 1 },{ "bu", 1 },{ "by", 1 },{ "ck", 1 },{ "cl", 1 },{ "co", 1 },{ "cr", 1 },{ "cu", 1 },
  { "da", 1 },{ "dd", 1 },{ "di", 1 },{ "ds", 1 },{ "du", 1 },{ "ec", 1 },{ "ep", 1 },{ "fa", 1 },
  { "ff", 1 },{ "fr", 1 },{ "gi", 1 },{ "go", 1 },{ "gu", 1 },{ "ic", 1 },{ "id", 1 },{ "ip", 1 },
  { "ir", 1 },{ "jo", 1 },{ "ke", 1 },{ "lo", 1 },{ "lp", 1 },{ "ls", 1 },{ "lt", 1 },{ "lw", 1 },
  { "mo", 1 },{ "mu", 1 },{ "no", 1 },{ "oa", 1 },{ "oi", 1 },{ "ol", 1 },{ "om", 1 },{ "os", 1 },
  { "ot", 1 },{ "ow", 1 },{ "oy", 1 },{ "pa", 1 },{ "pr", 1 },{ "pu", 1 },{ "qu", 1 },{ "rm", 1 },
  { "rt", 1 },{ "ru", 1 },{ "ry", 1 },{ "sa", 1 },{ "sk", 1 },{ "ss", 1 },{ "su", 1 },{ "ta", 1 },
  { "tn", 1 },{ "ue", 1 },{ "ui", 1 },{ "um", 1 },{ "us", 1 },{ "we", 1 },{ "wo", 1 },{ "ye", 1 },
  { "yi ",1 },{ NULL,0 }},
{ { "and",16},{ "are",16},{ "mor",10},{ "ore",6 },{ "tha",16},{ "wil",6 },{ "ing",16},{ "ake",6 }, 
  { "new",6 },{ "oup",3 },{ "par",6 },{ "ner",2 },{ "any",6 },{ "one",6 },{ "who",7 },{ "has",6 },
  { "his",6 },{ "tor",2 },{ "the",16},{ "cha",6 },{ "ter",6 },{ "way",6 },{ "set",16},{ "but",6 },
  { "for",16},{ "rum",6 },{ "not",16},{ "pla",2 },{ "ace",6 },{ "ask",6 },{ "hel",3 },{ "gam",3 },
  { "ame",6 },{ "sec",2 },{ "ret",3 },{ "you",6 },{ "wou",3 },{ "sur",6 },{ "pri",4 },{ "sed",6 },
  { "how",5 },{ "man",11},{ "peo",2 },{ "ple",3 },{ "are",6 },{ "sti",1 },{ "ill",6 },{ "aro",3 },
  { "und",2 },{ "rol",6 },{ "get",11},{ "ere",6 },{ "sat",6 },{ "fac",2 },{ "ion",11},{ "wit",6 },
  { "gre",2 },{ "eat",3 },{ "pur",3 },{ "pos",3 },{ "cur",2 },{ "ren",3 },{ "cou",1 },{ "hav",2 },
  { "ten",6 },{ "lis",6 },{ "ted",6 },{ "ant",6 },{ "mee",6 },{ "eet",2 },{ "few",2 },{ "ind",6 },
  { "fin",3 },{ "see",6 },{ "can",2 },{ "gon",2 },{ "one",11},{ "bit",6 },{ "aga",1 },{ "ain",2 },
  { "new",11},{ "lan",6 },{ "ith",6 },{ "her",6 },{ "mul",2 },{ "tip",6 },{ "que",1 },
  { "sts",1 },{ "dif",2 },{ "iff",2 },{ "ent",3 },{ "lev",1 },{ "loa",2 },{ "oak",4 },{ "dur",2 },
  { "ati",1 },{ "hid",6 },{ "den",6 },{ "fro",6 },{ "rom",6 },{ "sev",2 },{ "ral",3 },{ "rea",3 },
  { "son",6 },{ "whi",6 },{ "ich",6 },{ "mai",6 },{ "ain",6 },{ "nly",2 },{ "poi",6 },{ "day",16},
  { "whe",6 },{ "wer",6 },{ "ght",8 },{ "det",6 },{ "erm",2 },{ "ine",6 },{ "bes",6 },{ "est",6 },
  { "ild",11},{ "arr",6 },{ "ang",6 },{ "rtn",1 },{ "rpr",1 },{ NULL,0 }},
{ 20,50,66,85,92,100 },
{ 2,7,13,17,21,30,30,32,39,42,56,61,61,71,80,93,95,100,100,100 },
{ { NULL,	NULL,			FALSE } } },


// Alatharyan language created by Synrael */

{  "alatharya",    &gsn_language_alatharya,	FALSE,	FALSE,
{ { "-", NULL }, 
  { "-+", "+-", NULL }, 
  { "+-+","++-","-++","(tklscdzr)h-","-(tklscdzr)h","-+(aiu)","+(aeu)i",
     NULL },  
  { "+-+-","-+-+","-++-","++-+","+-++","-(tklscdzr)h-",
    "(tklscdzr)h-+","+-(tklscdzr)h", NULL },
  { "+-+-+","++-+-","++-y-","+-++-","+-+y-","-+-+-","-++-+","-+-++",
    "++-++","+-(srn)(tkcdz)h",
    "(tklscdzr)h-+-","+-(tklscdzr)h-","-(tklscdzr)h-+","-+-(tklscdzr)h",
    "(tklscdzr)h--+","+--(tklscdzr)h","-(tklscdzr)ha(ie)"
    ,"(tklscdzr)h-(tklscdzr)h", NULL },
  { "+-+-+-","+-+-y-","+-+-(tklscdzr)h","+-++-+","++-+-+","++-++-",
    "++-+a(ie)","++-+y-","-++-y-","-+-+y-",
    "+-++a(ie)","+-+--+","-++--+","-+--(tklscdzr)h","++--(tklscdzr)h",
    "-+-+-+","-++-+-","-++-(tklscdzr)h","-+-++-","--+-(tklscdzr)h",
    "--++-+","(pslctd)h(rls)-(tklscdzr)h","-+++-+","++-(srn)(tkcdz)h",
    "-+-(srn)(tkcdz)h","+-(rsnml)(tkcdz)h(eeau)","--(rsnml)(tkcdz)h(eeau)", 
    NULL },
  { "(pslctd)h(rls)-+-+","(pslctd)h(rls)-++-","(pslctd)h(rls)-+a(ie)",
    "++-+--+","++-+-+-","++-+-(tklscdzr)h","++-++-+","++-++a(ie)",
    "++-(rsnml)(tkcdz)h(eeau)","+-+++-+","+-(rsnml)(tkcdz)ha(ie)",
    "+-++-(tklscdzr)h","+-++-+-","+-++--+","+-+-+-+","+-+-+a(ie)",
    "+-+-++-","+--(rsnml)(tkcdz)h(eeau)","-+++-(tklscdzr)h","-+++--+",
    "-+++-+-","-++-+-+","-++-+a(ie)","-++-++-","-++-(srn)(tkcdz)h",
    "-++--(tklscdzr)h","-+-(rsnml)(tkcdz)h(eeau)","-+-++-+","-+-++a(ie)",
    "-+-+--+","-+-+-+-","-+-+-(tklscdzr)h","-+--+-+","-+--(srn)(tkcdz)h",
    "(pslctd)h(rls)-+y-","++-+-y-","+-++-y-","+-+-+y-","-++-+y-",
    "--+++-+","--++-(tklscdzr)h","--++--+", NULL },
  { "(pslctd)h(rls)-++a(ie)","(pslctd)h(rls)-++-+",
    "(pslctd)h(rls)-+-(tklscdzr)h","(pslctd)h(rls)-+--+","++-+-+-+",
    "++-(rsnml)(tkcdz)ha(ie)","++-+++-+","++-++-(tklscdzr)h","++-++--+",
    "++-+--(tklscdzr)h","++-+-(srn)(tkcdz)h","++-+-+a(ie)","-+-++-y-",
    "++-+--(tklscdzr)h","++-+-++-","+-+++-(tklscdzr)h","+-+++--+",
    "+-+++--+","+-+++-+-","+-++-(srn)(tkcdz)h","+-++-++-","+-++-+a(ie)",
    "+-++--(tklscdzr)h","+-+-(rsnml)(tkcdz)h(eeau)","+-+-++-+","+-+-++a(ie)",
    "+-+-+-(tklscdzr)h","+-+-+-+-","-+++-(srn)(tkcdz)h","-+++-++-",
    "-+++-+-+","++-+-+y-","+-+++-y-","+-++-+y-","-+++-+y-","+-+-+-y-",
    "-+++--(tklscdzr)h","-++-(rsnml)(tkcdz)h(eeau)","-++-++-+","-++-++a(ie)",
    "-++-+-(tklscdzr)h","-++-+-+-","-++-+--+","-+-+++-+","-+-+-+y-",
    "-+-(rsnml)(tkcdz)ha(ie)","-+-++-(tklscdzr)h","-+-++-+-","-+-++--+",
    "-+-+-(srn)(tkcdz)h","-+-+-++-","-+-+-+-+","-+-+-+a(ie)", NULL } },
  { {"th",8},{"ch",7},{"sh",7},{"sk",5},{"tz",5},{"ts",2},{"kh",10},
    {"jh",6},{"zh",5},{"mn",3},{"st",4},{"rt",3},{"ct",1},
    {"pl",1},{"ps",3},{"pr",2},{"ks",2},{"kz",3},{"dz",3},{"dr",2},
    {"dl",1},{"ds",1},{"dv",1},{"tv",2},{"kv",1},{"gz",1},{"gs",1},
    {"gv",1},{"gr",1},{"gh",2},{"sc",2},{"sv",1},{"sb",1},{"sm",1},
    {"sn",1},{"sl",1},{"sp",1},{"sr",2},{"cr",2},{"cl",1},{"cm",1},
    {"cn",1},{"cs",2},{"fr",1},{"fl",1},{"mb",3},{"mz",1},{"nz",1},
    {"ph",4},{"bh",1},{"rh",3},{"lh",2},{"ut",2},{"eh",2},{"el",3},
    {"ah",3},{"eh",2},{"ie",1},{"ia",1},{"ei",3},{"ai",3},{"oi",1},
    {"oa",1},{"oe",1},{"ya",2},{"ye",2},{"yu",1},{"yi",1},
    {"ui",1},{"ae",2},{"ao",1},{"au",1},{"eu",2},{"eo",1},{"ay",1},{NULL,0}},

  { {"skh",2},{"nth",2},{"sth",2},{"sch",1},{"chr",1},{"khr",1},{"uth",1},
    {"thr",2},{"ths",1},{"skr",1},{"dhr",1},{"rdh",1},{"rth",1},{"rkh",1},
    {"rch",1},{"mth",1},{"mdh",1},{"nch",1},{"nkh",2},{"phr",1},{"rph",1},
    {"sph",1},{"phl",1},{"lph",1},{"tht",1},{"sht",1},{"shr",1},{"thd",1},
    {"khv",1},{"iel",2},{"ael",2},{"aen",1},{"aes",1},{"aer",1},{"ien",1},
    {"the",2},{"rhu",2},{"thu",1},{"kai",1},{"hai",1},{"yar",2},{"yah",2},
    {"akh",1},{"ekh",2},{"psy",1},{"oah",1},{"iah",2},{"ari",1},{"tze",2},
    {"yel",2},{"yor",1},
    {"dzu",1},{"ion",1},{"eol",1},{"ior",1},{"pyr",1},{"oth",2},{NULL,0}},
  { 25, 47, 66, 80, 100, 100 },
  { 5, 11, 19, 23, 29, 36, 41, 48, 55, 61, 68, 73, 73, 79, 85, 92, 97, 97, 97, 99, 100},
  { {	NULL,	NULL,	FALSE } } },


  {  "srryn",    &gsn_language_srryn,	TRUE,	FALSE,
  {  { "-","s","+",NULL },
     { "+-","-+","--",NULL },
     { "++-","+--","+-+","-++","--+","(st)h-","-(st)h",NULL },
     { "+-++","++-+","++--","+--+","+---","(st)h-+","-(st)h-","--(st)h","-++-","-+++",NULL },
     { "+-++-","+--++","+---+","++--+","++-++","-+++-","-++--","-++-+","+++-+","+(st)h-+","(st)h-++","+--(st)h",NULL },
     { "+-++-+","+-+-++","+-+--+","++--++","++-++-","-+++-+","-++--+","+-++-+","+++-++","+(st)h-+-","(st)h-++","++--(st)h",NULL },
     { "++-+-++","+++-+-+","++-++-+","+--++-+","-+++-++","-++-+-+","+-+++-+","++-+++-","+-+-+++","+-++--+","++-++--",NULL },
     { "+++-+-++","+++-++-+","+++-+-++","+-+-++-+","+-++-+-+","+-+++-++","++-+++-+","-+-+-+++","-+-++--+","++-++--+",NULL } },
     { { "th",9 },{ "en",11 },{ "he",4 },{ "it",3 },{ "se",3 },{ "ar",2 },{ "ha",2 },{ "is",13 },{ "li",2 },{ "ns",13 },{ "ra",2 },
       { "rr",2 },{ "si",13 },{ "sl",13 },{ "sy",13 },{ "yt",2 },{ "st",13 },{ "al",1 },{ "as",13 },{ "es",13 },{ "eu",1 },{ "fo",1 },
       { "gh",1 },{ "hi",1 },{ "ho",1 },{ "ht",1 },{ "il",1 },{ "in",1 },{ "iy",1 },{ "la",1 },{ "ng",1 },{ "nt",1 },{ "of",1 },
       { "on",1 },{ "ot",1 },{ "rg",8 },{ "ry",1 },{ "sr",13 },{ "ss",16 },{ "su",12 },{ "sv",6 },{ "ty",1 },{ "ui",1 },{ "us",13 },
       { "uu",1 },{ "vi",1 },{ "yn",1 },{ "yr",1 },{ "ys",14 },{ "yz",1 },{ "zo",1 },{ NULL,0 }},
     { { "yth",11 },{ "tys",11 },{ "ith",5 },{ "eus",11 },{ "srr",11 },{ "sen",11 },{ "tho",1 },{ "oth",1 },{ "fen",1 },
       { "ese",12 },{ "ens",12 },{ "sse",12 },{ "nkh",4 },{ "ath",5 },{ "the",1 },{ "nse",9 },{ "lth",1 },
       { "tha",1 },{ "sal",5 },{ "ell",1 },{ "sst",14 },{ "kel",1 },{ "ith",5 },{ "thr",5 },{ "syn",11 },{ "ren",1 },
       { "nth",1 },{ "est",11 },{ "ern",1 },{ "lel",1 },{ "esa",5 },{ "bes",1 },{ "sle",11 },{ "ent",1 },{ "ste",5 },
       { "lla",1 },{ "nen",1 },{ "lal",1 },{ "eth",5 },{ "tin",1 },{ "esl",1 },{ "cor",1 },{ "sla",5 },{ "svy",1 },
       { "rrl",1 },{ "iss",15 },{ "sen",11 },{ "syr",11 },{ "yra",5 },{ "sla",12 },{ "rrg",1 },{ "ssi",14 },
       { "gha",1 },{ "ras",1 },{ "suu",1 },{ "iyz",1 },{ NULL,0 }},
     { 15,36,60,69,78,100 },
     { 0,0,0,3,3,9,9,9,14,14,26,26,26,37,81,96,97,97,97,100 },
  { {	NULL,	NULL,	FALSE } } },

    { "kankoran",		&gsn_language_kankoran,	TRUE,	FALSE,
    { { "(r---)", NULL }, 
      { "-+", "+-", NULL }, 
      { "+-+", NULL }, 
      { "+--+", "+++-", "+-++", "-+-+", NULL },
      { "++-++", "+-+-+", "+-++-", "++-+-", "r++-+", "r+-r+", "(kr)y-*-", 
	NULL }, 
      { "+-+++-", "+-++-+", "+++-++", "(kr)(jh)-++-", "(jr)-+++-", "+o++-+",
        "(krj)i++-+", NULL }, 
      { "+-+-++-", "++-+-++", "+-++-+-", "++-+-+-", "+++-+--", "+-+-+-+", 
        "+-++--+", "(ka)++(oa)+(oa)+", NULL }, 
      { "+-+--++-", NULL } },
      { { "ar", 17 }, { "an", 15 }, { "ka", 13 }, { "ra", 13 }, { "ir", 12 },
        { "ja", 12 }, { "or", 12 }, { "ko", 11 }, { "ha", 9  }, { "ch", 8  },
        { "kr", 7  }, { "al", 6  }, { "ro", 6  }, { "ak", 5  }, { "jo", 5  },
        { "kj", 5  }, { "ri", 5  }, { "ry", 5  }, { "kn", 4  }, { "ni", 4  },
	{ "ok", 4  }, { "rk", 4  }, { "ta", 4  }, { "da", 3  }, { "in", 3  },
	{ "ji", 3  }, { "lg", 3  }, { "na", 3  }, { "nk", 3  }, { "oc", 3  },
	{ "ol", 3  }, { "rh", 3  }, { "rm", 3  }, { "un", 3  }, { "yr", 3  },
	{ "ac", 2  }, { "ad", 2  }, { "ag", 2  }, { "ao", 2  }, { "as", 2  },
	{ "au", 2  }, { "ga", 2  }, { "gn", 2  }, { "hi", 2  }, { "ho", 2  },
	{ "hv", 2  }, { "it", 2  }, { "ki", 2  }, { "la", 2  }, { "li", 2  },
	{ "ma", 2  }, { "nd", 2  }, { "nh", 2  }, { "nm", 2  }, { "on", 2  },
	{ "rd", 2  }, { "re", 2  }, { "rj", 2  }, { "rr", 2  }, { "rs", 2  },
	{ "ru", 2  }, { "ti", 2  }, { "ug", 2  }, { "ul", 2  }, { "va", 2  },
	{ "ai", 1  }, { "aj", 1  }, { "bj", 1  }, { "br", 1  }, { "cr", 1  },
	{ "dd", 1  }, { "di", 1  }, { "dj", 1  }, { "dl", 1  }, { "ei", 1  },
	{ "ek", 1  }, { "er", 1  }, { "go", 1  }, { "gu", 1  }, { "hr", 1  },
	{ "ia", 1  }, { "id", 1  }, { "il", 1  }, { "im", 1  }, { "jr", 1  },
	{ "jy", 1  }, { "kh", 1  }, { "ld", 1  }, { "lj", 1  }, { "lm", 1  },
	{ "lt", 1  }, { "mi", 1  }, { "mu", 1  }, { "ng", 1  }, { "nj", 1  },
	{ "nn", 1  }, { "no", 1  }, { "nv", 1  }, { "od", 1  }, { "oj", 1  },
	{ "os", 1  }, { "ot", 1  }, { "rc", 1  }, { "rg", 1  }, { "rl", 1  },
	{ "rn", 1  }, { "sk", 1  }, { "sl", 1  }, { "st", 1  }, { "th", 1  },
	{ "tj", 1  }, { "tr", 1  }, { "tu", 1  }, { "tv", 1  }, { "ve", 1  },
	{ "vi", 1  }, { "ya", 1  }, { "yh", 1  }, { "yk", 1  }, { NULL, 0  } },
      { { "kan", 1 }, { "rir", 1 }, { "kaj", 1 }, { "rha", 1 }, { "aug", 1 },
	{ "akj", 1 }, { "jao", 1 }, { "rao", 1 }, { "kor", 1 }, { "kar", 1 },
	{ "kja", 1 }, { "kjo", 1 }, { "rja", 1 }, { "rsk", 1 }, { "kra", 1 },
        { "ark", 1 }, { "ran", 1 }, { "rir", 1 }, { "jar", 1 }, { "jor", 1 },
        { "cho", 1 }, { "arg", 1 }, { "kul", 1 }, { "bja", 1 }, { "lia", 1 },
	{ NULL,  0 } },
    {  51, 54, 72, 93,  99, 100 },
    {  1, 4, 8, 9, 12, 18, 27, 43, 49, 52, 64, 64, 64, 92, 93, 97, 98, 98, 99, 100, 100 },
  { {	NULL,	NULL,	FALSE } } },


{  "ch'taren",           &gsn_language_chtaren,	FALSE,	TRUE,
    { { "-", NULL }, 
      { "-+", "+-", "a(eiu)", NULL }, 
      { "-++", "-+-", "+--", "++-", "+-+", NULL },
      { "--+-", "-+--", "+---", "++--", "+-+-", "-+-+", "+--+", "--++", "+-++", "++-+", NULL },
      { "-+---", "--+--", "-+--+", "--+-+", "-+--+", "-++--", "-++-+", "+--+-", "+-+--", "++---", "++--+", "++-+-", "+-++-", "+-+-+", "++-++", NULL },
      { "++'+-+", "++'+--", "-+'+-+", "-+'+--", "--+--+", "--++--", "-+--+-", "-+---+", "-++-+-", "-+--++", "--++-+", "--+-++", "-++-++", "+--+--", "+---+-", "+-+---", "+--+-+", "+--++-", "+-+--+", "++---+", "++--+-", "++-+--", "++-+-+", "++-++-", "++--++", NULL },
      { "++'+-+-", "++'+--+", "++'+-++", "-+'+-+-", "-+'+--+", "-+'+-++", "--+--+-", "--+---+", "--+-+--", "--++---", "--+--++", "--+-+-+", "--++--+", "-+---+-", "-+-+---", "-++---+", "-++--+-", "-++--++", "-++-+-+", "++-+-++", "++-+--+", "++-+-+-", "++-+---", "++--+--", "++---+-", "+---+--", "+--+---", "+-+---+", "+-+--+-", "+-+-+--", "+-++---", "+-++--+", "+-++-++", NULL },
      { "++'+--+-", "++'+-+--", "-+'+-++-", "-+'+--+-", "++'+-++-", "++'+--++", "--++--+-", "-++---+-", "++-+--+-", "+--+-++-", "+--+-+--", "-+-++-+-", NULL } },
    { { "la", 16 }, { "li", 15 }, { "ha", 13 }, { "hi", 13 }, { "wy", 12 }, { "le", 12},
      { "sa", 11 }, { "ra", 10 }, { "th", 10 }, { "ni", 10 }, { "ma", 10 }, { "il", 10},
      { "sy", 10 }, { "si", 9 }, { "ry", 9 }, { "re", 9 }, { "ar", 9 }, { "ir", 9 },
      { "al", 9 }, { "el", 8 }, { "mi", 8 }, { "ch", 7 }, { "ri", 7 }, { "an", 7 },
      { "ah", 7 }, { "es", 6 }, { "as", 6 }, { "sh", 5 }, { "ai", 5 }, { "ae", 5 },
      { "ia", 5 }, { "ea", 4 }, { "ev", 4 }, { "se", 4 }, { "ey", 4 }, { "em", 4 },
      { "er", 4 }, { "ei", 3 }, { "iv", 3 }, { "is", 3 }, { "th", 3 }, { "am", 3 },
      { "ys", 2 }, { "aw", 2 }, { "ta", 2 }, { "va", 2 }, { "it", 2 }, { "wh", 2 },
      { "en", 2 }, { "yr", 2 }, { "hu", 2 }, { "we", 2 }, { "he", 2 }, { "ru", 2 },
      { "ad", 2 }, { "ur", 2 }, { "av", 2 }, { "ay", 2 }, { "lo", 2 }, { "hy", 2 },
      { "ly", 2 }, { "ne", 2 }, { "ny", 2 }, { "vi", 2 }, { "ca", 2 }, { "ce", 2 },
      { "cy", 2 }, { "at", 2 }, { "in", 2 }, { "ys", 2 }, { "ya", 2 }, { "ll", 2 },
      { "ow", 1 }, { "ve", 1 }, { "et", 1 }, { "ed", 1 }, { "du", 1 }, { "ho", 1 },
      { "ol", 1 }, { "ul", 1 }, { "ma", 1 }, { "wy", 1 }, { "ur", 1 }, { "ed", 1 },
      { "jh", 1 }, { "ky", 1 }, { "ki", 1 }, { "ka", 1 }, { "ko", 1 }, { "ak", 1 },
      { "ik", 1 }, { "st", 1 }, { "us", 1 }, { "bw", 1 }, { "bl", 1 }, { "ny", 1 },
      { "ie", 1 }, { "ei", 1 }, { "ik", 1 }, { "ac", 1 }, { "ja", 1 }, { "wi", 1 },
      { "wa", 1 }, { "ph", 1 }, { "yl", 1 }, { "nl", 1 }, { "ul", 1 }, { "na", 1 },
      { "mi", 1 }, { NULL, 0 } },
    { { "sha", 5 }, { "the", 4 }, { "aia", 3 }, { "aer", 3 }, { "ell", 3 },
      { "iel", 3 }, { "aen", 2 }, { "nia", 2 }, { "ira", 1 }, { "vau", 1 },
      { "ava", 1 }, { "mae", 1 }, { "qua", 1 }, { "cha", 1 }, { "all", 1 },
      { "ren", 1 }, { "mel", 1 }, { "kae", 1 }, { "vai", 1 }, { "ali", 1 },
      { "era", 1 }, { "shi", 1 }, { "tha", 1 }, { "eli", 1 }, { "des", 1 },
      { "min", 1 }, { "hae", 1 }, { "ish", 1 }, { "lar", 1 }, { "ves", 1 },
      { "pha", 1 }, { "fae", 1 }, { "lai", 1 }, { "lis", 1 }, { "ush", 1 },
      { NULL, 0 } },
    { 35, 55, 75, 87, 95, 100 },
    { 1, 5, 7, 8, 9, 20, 20, 22, 37, 44, 50, 51, 56, 64, 76, 84, 90, 96, 97, 99, 100 },
  { {	NULL,	NULL,	FALSE } } },


{ "aelin", &gsn_language_aelin,	FALSE,	FALSE,
{ { "(eai)", NULL}, 
  { "-+", "r-", "-r",NULL},
  { "--+", "ae+", "+-+", "r--", "r-+", "e-+", "n-+","ae-", NULL},
  { "en+-","e-+-", "ph-+", "-l-+", "il--", "++-n", "il-+", "-d-+",NULL},
  { "--+-+", "+--+-", "+-+-+", "ia+-+", "e++--", "ae+-+",
    "+-+-s", "+-d-l", "-+d-l", "l-l--", NULL},
  { "-n+--+", "-l-d+-", "+--+-+", "+-++--", "+ae+-+", "+-++-+",NULL},
  { "-++--+-", "+-+-+-+", "-++--ru", "+ae+-+-","+l-++-+", NULL},
  { "-+-+--+-", "--+--+-+", "-+-+-+-+", "(ps)l-+-+-+", "(ps)h--+-+-",NULL}
},
  { {"ra", 11}, {"ae", 9}, {"ai", 5}, {"al", 5}, {"eo", 5}, {"er", 5},
  {"ir", 5}, {"lo", 5}, {"an", 4}, {"ar", 4}, {"da", 4}, 
  {"en", 4}, {"il", 4}, {"ri", 4}, {"ru", 4}, {"st", 4},
  {"ya", 4}, {"as", 3}, {"es", 3}, {"eu", 3}, {"ha", 3},
  {"ia", 3}, {"li", 3}, {"od", 3}, {"on", 3}, {"th", 3},
  {"ur", 3}, {"us", 3}, {"yn", 3}, {"ap", 2}, {"el", 2},
  {"ge", 2}, {"he", 2}, {"io", 2}, {"iy", 2}, {"la", 2},
  {"ll", 2}, {"ly", 2}, {"na", 2}, {"ol", 2}, {"os", 2}, 
  {"ph", 2}, {"ty", 2}, {"yr", 2}, {"ab", 1}, {"ad", 1},
  {"ao", 1}, {"ay", 1}, {"be", 1}, {"br", 1}, {"ca", 1}, 
  {"de", 1}, {"dh", 1}, {"di", 1}, {"dr", 1}, {"dv", 1},
  {"dy", 1}, {"ea", 1}, {"ed", 1}, {"hi", 1}, {"ho", 1},
  {"id", 1}, {"im", 1}, {"in", 1}, {"is", 1}, {"it", 1},
  {"iu", 1}, {"ma", 1}, {"nd", 1}, {"ne", 1}, {"ni", 1},
  {"nu", 1}, {"op", 1}, {"or", 1}, {"pe", 1}, {"pu", 1},
  {"rg", 1}, {"rl", 1}, {"ro", 1}, {"rt", 1}, {"ry", 1},
  {"sa", 1}, {"se", 1}, {"sh", 1}, {"sr", 1}, {"su", 1},
  {"ti", 1}, {"tr", 1}, {"ue", 1}, {"ul", 1}, {"va", 1},
  {"yl", 1}, {NULL, 0}}, 
  { {"eod", 5}, {"aiy", 2}, {"dil", 2}, {"iru", 3},
  {"ila", 1}, {"ael", 5}, {"eru", 2}, {"dru", 2}, 
  {"ilo", 2}, {"dai", 1}, {"ira", 2}, {"rae", 4},
  {"alo", 2}, {"lis", 3}, {"deu", 2}, {"lyr", 1},
  {"aeo", 4}, {"pho", 3}, {"sao", 1}, {"iab", 1},
  {"los", 2}, {"aiu", 3}, {"dhr", 2}, {"aio", 2},
  {"eas", 3}, {"ada", 1}, {"ral", 4}, {"olo", 3},
  {"eol", 4}, {"san", 1}, {"sel", 1}, {NULL, 0}},
  {34, 53,81, 91, 100, 100}, 
  { 2, 4, 12, 12, 14, 22, 22, 22, 34, 36, 48, 53, 53, 
    74, 86, 92, 93,93,93,100,100},
  { {	NULL,	NULL,	FALSE } } },


  {  "shuddeni",     &gsn_language_shuddeni,	FALSE,	FALSE,
  { {  "-", NULL },
  {  "+-","-+",NULL },
  {  "++-","+-+","-++","-+-",NULL },
  {  "+-++","++-+","+-+-","++--","-++-","-+-+",NULL },
  {  "++-++", "++--+", "+-+-+", "++-+-", "+-++-","-++-+","-+-++",NULL },
  {  "++-++-","++--++","++-+-+","+-++-+","+-+-++","+-+-+-","-++-++","-++--+","-+-++-","-+--++",NULL },
  {  "++-++-+","++--++-","++-+-++","+-++-++","+-+-++-","++--+-+","-++-+-+","-++-++-","-++--++","-+-++-+","-+-+-++",NULL },
  {  "++-++-++","++--++-+","++-+-++-","++-+--++","+-++-++-","+-+-++-+","++--+-++","-++-+-++","-++-++-+","+-++--++","-+-++-+-","-+-+-++-",NULL} },
  { { "sh",21 },{ "ar",17 },{ "ha",5 },{ "ru",15 },{ "hi",3 },{ "th",12 },{ "ch",9 },{ "al",8 },{ "ir",8 },
    { "ja",8 },{ "jj",14 },{ "ri",8 },{ "ur",8 },{ "ku",7 },{ "la",7 },{ "aj",11 },{ "es",6 },{ "hu",1 },{ "ka",6 },
    { "kh",16 },{ "na",3 },{ "ra",3 },{ "ul",6 },{ "yi",12 },{ "yu",12 },{ "ak",12 },{ "an",5 },{ "as",5 },{ "ek",5 },
    { "en",5 },{ "ij",5 },{ "in",5 },{ "it",5 },{ "ki",5 },{ "ni",5 },{ "ay",4 },
    { "be",1 },{ "de",4 },{ "el",4 },{ "ik",4 },{ "is",4 },{ "iy",4 },{ "ol",4 },{ "rk",4 },{ "rr",4 },{ "he",3 },
    { "je",3 },{ "ji",3 },{ "jn",3 },{ "kr",12 },{ "le",3 },{ "lu",3 },{ "rj",3 },{ "rs",3 },{ "sk",9 },{ "uk",3 },
    { "zi",3 },{ "ag",2 },{ "at",2 },{ "av",2 },{ "dd",6 },{ "dh",2 },{ "di",2 },{ "ga",2 },{ "gr",2 },
    { "hr",2 },{ "id",2 },{ "ig",2 },{ "il",2 },{ "im",2 },{ "kk",12 },{ "li",2 },{ "lk",8 },{ "ma",2 },
    { "mu",2 },{ "nu",2 },{ "or",2 },{ "ta",2 },{ "tl",2 },{ "ud",2 },{ "uh",2 },{ "un",2 },{ "us",2 },{ "ut",2 },
    { "va",2 },{ "ya",8 },{ "ye",2 },{ "ad",1 },{ "ah",1 },{ "ai",1 },{ "am",1 },{ "az",1 },
    { "ba",1 },{ "do",1 },{ "dr",8 },{ "du",1 },{ "ec",1 },{ "ej",1 },{ "et",1 },{ "ev",1 },{ "ey",1 },{ "gl",1 },
    { "hl",1 },{ "hy",1 },{ "ib",1 },{ "ih",1 },{ "ke",1 },{ "ks",7 },{ "kt",5 },{ "lt",5 },{ "me",1 },{ "mk",1 },
    { "ms",1 },{ "nd",1 },{ "ne",1 },{ "nk",1 },{ "nl",1 },{ "nm",1 },{ "no",1 },{ "ou",1 },{ "re",1 },{ "rl",1 },
    { "sa",1 },{ "se",1 },{ "si",1 },{ "sm",1 },{ "sn",1 },{ "ug",1 },{ "um",1 },{ "uz",5 },{ "vh",5 },{ "yh",10 },{NULL,0}},
  { { "eni",1 },{ "cha",3 },{ "mak",1 },{ "kra",5 },{ "ajj",5 },{ "nai",1 },{ "ish",6 },{ "urr",4 },{ "ijj",5 },{ "ask",1 },
    { "sku",3 },{ "add",1 },{ "uth",3 },{ "ala",1 },{ "tha",3 },{ "jji",3 },{ "chi",3 },{ "jis",1 },
    { "thi",1 },{ "yul",6 },{ "yig",6 },{ "ath",1 },{ "the",1 },{ "tho",1 },{ "ath",1 },{ "isk",1 },{ "kul",6 },
    { "nol",1 },{ "ejj",4 },{ "ekk",5 },{ "ket",1 },{ "rkh",6 },{ "ura",4 },{ "amu",4 },{ "ash",4 },{ "aki",1 },
    { "aga",5 },{ "sha",5 },{ "dij",1 },{ "jal",1 },{ "arj",1 },{ "den",1 },{ "uzi",5 },{ "ira",1 },{ "uka",1 },
    { "eyi",1 },{ "cho",1 },{ "esh",1 },{ "hru",3 },{ "chi",1 },{ "mir",1 },{ "iru",1 },{ "ksa",5 },{ "iru",5 },
    { "zir",1 },{ "tha",5 },{ "tla",3 },{ "yud",5 },{ "yur",5 },{ "skr",5 },{ "haz",2 },{ "mah",2 },{ "lkh",4 },
    { "akr",4 },{ "dri",1 },{ "ict",2 },{ "ect",2 },{NULL,0}},
  { 32,44,69,73,93,100 },
  { 2,6,12,12,15,21,29,39,48,52,62,62,62,79,89,98,99,99,99,100 },
  { {	NULL,	NULL,	FALSE } } },


  {  "nefortu",     &gsn_language_nefortu,	FALSE,	FALSE,
  { {  "-", NULL },
  {  "+-","-+",NULL },
  {  "++-","+-+","-++","-+-",NULL },
  {  "++-+","+-+-","+-++","+--+","-+-+","-+++","-++-",NULL },
  {  "++-+-","++--+","++--+","+-+-+","+-++-","-++-+","-+-+-","-+++-","--+-+","--++-+",NULL },
  {  "++--++","++-++-","++-+-+","+-+-++","+--+-+","+-++-+","-++-+-","-+-++-","--+-++","-+--++",NULL },
  {  "++-+-++","++-++-+","++-++-+","+-+--++","+--+--+","+-++--+","+-++-+-","-++-++-","+--+-++","-++--++","-++-+-+","-+-+-++","-+--+-+",NULL },
  {  "++-++-++","++-+++-+","+-++--++","++--+--+","+-++-+-+","+-++-+-+","-++--++-","+--++-++","-++--+++","-++-+-++",NULL } },
  {  { "al", 17 },{ "ch", 10 },{ "ay", 8 },{ "li", 8 },{ "an", 7 },{ "ha", 7 },{ "ja", 7 },{ "ya", 7 },{ "aj", 5 },{ "il", 5 },
     { "la", 5 },{ "ol", 5 },{ "ak", 4 },{ "am", 4 },{ "ka", 4 },{ "ma", 4 },{ "qa", 4 },{ "ba", 3 },{ "im", 3 },{ "jo", 3 },
     { "na", 3 },{ "uc", 3 },{ "ac", 2 },{ "aq", 2 },{ "az", 2 },{ "de", 2 },{ "dj", 2 },{ "ei", 2 },{ "ia", 2 },{ "ik", 2 },
     { "ix", 2 },{ "iy", 2 },{ "iz", 2 },{ "ji", 2 },{ "ki", 2 },{ "os", 2 },{ "re", 2 },{ "sa", 2 },{ "su", 2 },{ "th", 2 },
     { "tz", 2 },{ "ye", 2 },{ "yi", 2 },{ "yj", 2 },{ "yo", 2 },{ "za", 2 },{ "zl", 2 },{ "aa", 1 },{ "ab", 1 },{ "ah", 1 },
     { "ar", 1 },{ "as", 1 },{ "aw", 1 },{ "be", 1 },{ "bi", 1 },{ "co", 1 },{ "da", 1 },{ "ek", 1 },{ "el", 1 },{ "en", 1 },
     { "er", 1 },{ "es", 1 },{ "et", 1 },{ "ey", 1 },{ "ez", 1 },{ "ga", 1 },{ "hb", 1 },{ "hi", 1 },{ "hn", 1 },{ "ho", 1 },
     { "ic", 1 },{ "id", 1 },{ "ii", 1 },{ "ij", 1 },{ "in", 1 },{ "iq", 1 },{ "jm", 1 },{ "kt", 1 },{ "lj", 1 },{ "ll", 1 },
     { "mu", 1 },{ "my", 1 },{ "nc", 1 },{ "nd", 1 },{ "ne", 1 },{ "ni", 1 },{ "nu", 1 },{ "oj", 1 },{ "om", 1 },{ "ri", 1 },
     { "ru", 1 },{ "se", 1 },{ "si", 1 },{ "so", 1 },{ "te", 1 },{ "to", 1 },{ "ts", 1 },{ "tu", 1 },{ "ua", 1 },{ "ul", 1 },
     { "un", 1 },{ "uy", 1 },{ "wa", 1 },{ "xt", 1 },{ "yy", 1 },{ "zd", 1 },{ "zk", 1 },{ "zr", 1 },{ NULL,0 }},
  {  { "jim",1 },{ "chi",3 },{ "iaj",3 },{ "etz",1 },{ "law",1 },{ "tza",3 },{ "jal",3 },{ "zay",4 },{ "kal",1 },{ "ila",4 },
     { "aqa",1 },{ "gah",1 },{ "nen",1 },{ "kab",1 },{ "nde",1 },{ "elj",1 },{ "ajm",3 },{ "mak",1 },{ "izl",2 },{ "iak",1 },
     { "tsa",3 },{ "lli",1 },{ "lin",1 },{ "jaj",1 },{ "laa",3 },{ "nix",1 },{ "kal",1 },{ "cha",1 },{ "jak",1 },
     { "jol",1 },{ "ich",1 },{ "uch",1 },{ "bal",1 },{ "kan",1 },{ "biq",1 },{ "ach",1 },{ "mye",1 },{ "sol",1 },{ "kii",3 },
     { "iil",3 },{ "nul",1 },{ "joj",1 },{ "lik",3 },{ "qaq",3 },{ "suy",1 },{ "asa",1 },{ "kiy",3 },{ "yil",1 },{ "ayi",3 },
     { "yim",1 },{ "bay",3 },{ "yal",3 },{ "aya",3 },{ "yay",3 },{ "yol",3 },{ "lim",3 },{ "nam",1 },{ "bar",1 },{ "una",1 },
     { "tua",1 },{ "lan",1 },{ "liy",1 },{ "yer",1 },{ "rey",1 },{ "han",1 },{ "nay",1 },{ "dja",1 },{ "mal",1 },{ "azr",1 },
     { "rik",1 },{ "aza",1 },{ "yja",1 },{ "ixt",1 },{ "omu",1 },{ "cos",1 },{ "siz",1 },{ "kth",1 },{ "tha",1 },{ "lij",1 },
     { "rei",1 },{ "lak",1 },{ "sei",1 },{ "dek",1 },{ "tez",1 },{ "dal",1 },{ NULL,0 } },
  { 46,54,73,80,86,100 },
  { 3,8,11,11,11,19,28,36,58,64,71,71,72,74,80,84,87,87,88,89,100 },
  { {	NULL,	NULL,	FALSE } } },


  {  "caladaran",    &gsn_language_caladaran,	FALSE,	FALSE,
  {  { "-",NULL },
     { "+-","-+","--",NULL },
     { "++-","+--","+-+","-++","-+-","--+","(cs)h-","-(cs)h","-s(kst)","-(dm)(rls)",NULL },
     { "+--+","+-++","++-+","-++-","-+-+","+-+-","-+--","--++","ch-+","-s--","-ss-","+-s(kn)","-(lnmd)(lnmd)-","ch--","-(dm)(rls)-",  NULL},
     { "++-+-","++--+","+-++-","+--++","-++-+","-+-++","-++--","ch-+-","(cs)h-++","(dlj)r-+-","-s(kns)-+",NULL },
     { "++-++-","++--++","++-+-+","++-+--","+-+-++","+-+--+","+--++-","-++-++","-+-++-","-+-+-+", NULL},
     { "++-++-+","++-+--+","+-+-++-","+-+--++","+--++-","+-++-++","-++-+-+","-++-++-","-+-+-++",NULL},
     { "++-++-++","++-+--++","+-+-++-+","+-+--++-","+--++-+","+-++-++-","-++-+-++","-++-++-+","-+-+-++-",NULL} },
     { { "as",15 },{ "ch",14 },{ "is",13 },{ "sa",11 },{ "ha",1 },{ "ji",8 },{ "nd",8 },{ "sk",12 },
       { "ss",1 },{ "an",7 },{ "ar",7 },{ "da",7 },{ "il",7 },{ "ri",7 },{ "ia",6 },{ "ma",10 },{ "st",9 },
       { "al",5 },{ "hi",1 },{ "ja",5 },{ "li",5 },{ "ra",5 },{ "si",5 },{ "am",4 },{ "ij",4 },{ "in",4 },
       { "ir",4 },{ "ka",4 },{ "la",4 },{ "rr",4 },{ "ya",1 },{ "di",3 },{ "dr",3 },{ "id",3 },
       { "im",3 },{ "lm",3 },{ "mi",3 },{ "mj",3 },{ "os",3 },{ "ta",3 },{ "ad",2 },{ "aj",2 },{ "fr",2 },
       { "jm",2 },{ "ki",2 },{ "ln",2 },{ "ml",2 },{ "on",2 },{ "ro",2 },{ "sy",2 },{ "dj",1 },{ "el",1 },
       { "ho",1 },{ "ii",1 },{ "ip",1 },{ "jo",1 },{ "lj",1 },{ "ls",1 },{ "ly",1 },{ "na",1 },{ "ni",1 },{ "ny",1 },
       { "pt",1 },{ "rt",1 },{ "sd",1 },{ "se",1 },{ "so",1 },{ "un",1 },{ "wi",1 },{ NULL,0}},
     { { "cha",10 },{ "sal",5 },{ "jma",10 },{ "mir",5 },{ "cha",5 },{ "lad",5 },{ "ara",1 },{ "jas",8 },{ "jis",8 },
       { "lis",8 },{ "lja",4 },{ "ask",5 },{ "mas",3 },{ "fri",2 },{ "chi",1 },{ "dji",5 },{ "dip",1 },{ "tan",1 },
       { "iln",1 },{ "kil",1 },{ "jmi",10 },{ "jia",10 },{ "mar",5 },{ "ija",5 },{ "dam",1 },{ "isa",10 },{ "sar",10 },
       { "ras",10 },{ "ara",9 },{ "isk",10 },{ "imi",9 },{ "lir",5 },{ "fra",1 },{ "ray",1 },{ "min",1 },
       { "ast",10 },{ "dis",5 },{ "sil",5 },{ "dri",5 },{ "sta",1 },{ NULL,0}},
     { 52,55,92,94,95,100 },
     { 0,7,14,15,15,22,31,35,45,53,61,62,62,72,93,98,98,100,100,100 },
  { {	NULL,	NULL,	FALSE } } },


{  "ethron",    &gsn_language_ethron,	FALSE,	FALSE,
{ { "-", NULL },
  { "-+", "+-", NULL },
  { "+--","+-+","-+-","--+","-++",NULL },
  { "+-+-","+-++","-++-","-+--","-+-+",NULL },
  { "+-+-+","+-++-","+--++","-++-+","--++-","-+--+","--+-+","-++--",NULL },
  { "-++--+","+-+--+","+--+-+","+--++-","-++-+-","--++-+","-++--+","--++-+","-++--+",NULL },
  { "-++-+-+","+-++--+","+--++-+","+--++-+","-++-+-+","-+-++-+","-++-+-+","--+-+-+","--++--+",NULL },
  { "-++-+-++","+-++-+-+","+-+-++-+","-+--++-+","-++--+-+","-+-+-+-+","-++-+-++",NULL } },
{ { "il",18},{ "ar",12},{ "an",8 },{ "on",7 },{ "al",6 },{ "el",6 },{ "en",6 },{ "ir",6 },{ "in",5 },
  { "la",5 },{ "mi",5 },{ "ra",5 },{ "fi",4 },{ "ma",4 },{ "qu",4 },{ "ri",4 },{ "ya",4 },{ "as",3 },
  { "di",3 },{ "io",3 },{ "lm",3 },{ "nd",3 },{ "pa",3 },{ "ry",3 },{ "th",3 },{ "ua",3 },{ "am",2 },
  { "ci",2 },{ "ie",2 },{ "is",2 },{ "lc",2 },{ "le",2 },{ "li",2 },{ "ni",2 },{ "nn",2 },{ "nu",2 },
  { "ol",2 },{ "qi",2 },{ "rd",2 },{ "ro",2 },{ "st",2 },{ "ta",2 },{ "ti",2 },{ "ue",2 },{ "ur",2 },
  { "yo",2 },{ "ad",1 },{ "at",1 },{ "da",1 },{ "de",1 },{ "do",1 },{ "du",1 },{ "ea",1 },{ "eq",1 },
  { "er",1 },{ "et",1 },{ "ey",1 },{ "fa",1 },{ "ga",1 },{ "gi",1 },{ "he",1 },{ "hi",1 },{ "hr",1 },
  { "im",1 },{ "it",1 },{ "ld",1 },{ "lg",1 },{ "ll",1 },{ "lu",1 },{ "ly",1 },{ "me",1 },{ "mm",1 },
  { "mo",1 },{ "na",1 },{ "ng",1 },{ "nm",1 },{ "nt",1 },{ "nw",1 },{ "ny",1 },{ "oi",1 },{ "ot",1 },
  { "pf",7 },{ "pi",1 },{ "qa",1 },{ "re",1 },{ "rm",1 },{ "rn",1 },{ "ru",1 },{ "sa",1 },{ "si",1 },
  { "um",1 },{ "un",1 },{ "us",1 },{ "va",1 },{ "vi",1 },{ "we",1 },{ "yd",1 },{ "yi",1 },{ NULL,0 }},
{ { "eth",4 },{ "ron",1 },{ "qil",9 },{ "arn",1 },{ "eqi",7 },{ "ril",11},{ "san",1 },{ "eru",1 },
  { "eal",6 },{ "yon",5 },{ "lar",5 },{ "far",6 },{ "sti",1 },{ "fil",11},{ "cir",1 },
  { "enn",4 },{ "nur",1 },{ "fir",11},{ "ami",5 },{ "sta",1 },{ "gir",1 },{ "yas",1 },
  { "dur",1 },{ "ila",11},{ "til",5 },{ "lam",1 },{ "mar",1 },{ "ion",1 },{ "que",1 },{ "lin",1 },
  { "tan",1 },{ "qua",1 },{ "yar",4 },{ "rie",1 },{ "lma",5 },{ "ani",5 },{ "lan",1 },{ "qar",5 },
  { "pal",5 },{ "cil",4 },{ "olm",1 },{ "mol",1 },{ "oth",1 },{ "imi",1 },{ "mal",1 },{ "eny",1 },
  { "rel",1 },{ "val",1 },{ "del",1 },{ "vin",1 },{ "dil",1 },{ "yar",4 },{ "all",1 },{ "lin",1 },
  { "pfi",4 },{ "pfa",4 },{ "ily",1 },{ "ume",1 },{ "end",1 },{ "ara",4 },{ "pan",5 },{ "iel",1 },
  { "pir",11 },{ "mil",9 },{ "sil",11 },{ "ilm",1 },{ "mir",1 },{ "dan",1 },{ "wen",1 },{ NULL,0 }},
{ 32,46,79,88,95,100 },{ 0,1,6,9,10,12,12,12,34,42,62,65,74,88,93,97,99,100,100,100 },
  { {	NULL,	NULL,	FALSE } } },


{  "arcane",     &gsn_language_arcane,        FALSE,	FALSE,
  { {  "-","+",NULL },
  {  "+-",NULL },
  {  "+-+","+--",NULL },
  {  "-+-+","+-++","++-+",NULL },
  {  "+-+-+", "-++-+", "++--+", "++-++", "--+-+","+---+",NULL },
  {  "+-++-+","+-+-++","++--++","-++-+-","++-+-+","++-++-","+--+-+","-++-++","--+-++",NULL },
  {  "-++-+-+","--+++-+","+-++--+","++-++-+","-++-+++",NULL },
  {  "+-++-+-+","++---+-+",NULL} },
  
{ { "ta",5 },{ "sh",6 },{ "xa",2 },{ "ou",1 },{ "mu",2 },{ "dh",1 },{ "ve",1 },
  { "lp",1 },{ "di",1 },{ "de",3 },{ "to",4 },{ "ul",5 },{ "mi",2 },{ "la",7 },
  { "li",2 },{ "et",1 },{ "pt",1 },{ "lb",1 },{ "hr",1 },{ "ar",10},{ "or",4 },
  { "lt",1 },{ "iy",2 },{ "ku",1 },{ "ha",3 },{ "lm",1 },{ "og",2 },{ "bo",1 },
  { "hl",1 },{ "es",2 },{ "rg",1 },{ "ag",1 },{ "ye",4 },{ "un",1 },{ "az",1 },
  { "in",4 },{ "mo",1 },{ "zl",1 },{ "hi",4 },{ "oc",1 },{ "nd",3 },{ "za",1 },
  { "ng",2 },{ "bi",1 },{ "na",1 },{ "rr",1 },{ "ox",1 },{ "lo",6 },{ "ie",2 },
  { "ct",1 },{ "lw",1 },{ "mn",1 },{ "an",1 },{ "nt",1 },{ "er",1 },{ "te",1 },
  { "ot",2 },{ "tr",2 },{ "al",4 },{ "wa",1 },{ "ne",1 },{ "ya",1 },{ "tu",1 },
  { "ru",1 },{ "ek",3 },{ "vl",1 },{ "st",2 },{ "ll",7 },{ "go",2 },{ "en",3 },
  { "av",1 },{ "ue",1 },{ "ug",1 },{ "em",2 },{ "ok",2 },{ "re",4 },{ "da",3 },
  { "at",3 },{ "hy",2 },{ "on",2 },{ "gr",1 },{ "ni",1 },{ "ma",4 },{ "me",1 },
  { "lk",2 },{ "am",2 },{ "th",6 },{ "yu",1 },{ "nn",2 },{ "ml",1 },{ "ak",11},
  { "el",7 },{ "yo",1 },{ "ms",1 },{ "ba",1 },{ "ur",1 },{ "il",2 },{ "ko",1 },
  { "ig",1 },{ "um",2 },{ "le",3 },{ "ov",1 },{ "sa",1 },{ "ol",3 },{ "ti",1 },
  { "lu",1 },{ "rk",1 },{ "rw",1 },{ "ga",2 },{ "ed",1 },{ "vo",1 },{ "ez",1 },
  { "ac",1 },{ "iu",1 },{ "va",1 },{ "kh",2 },{ "we",1 },{ "as",4 },{ "ra",7 },
  { "oo",1 },{ "zr",1 },{ "ch",1 },{ "uv",2 },{ "ei",1 },{ "ad",1 },{ "dl",1 },
  { NULL,0 } },
  
{ { "tar",3 },{ "des",1 },{ "mox",1 },{ "tek",1 },{ "ema",1 },{ "mak",2 },
  { "uma",1 },{ "gas",1 },{ "ash",2 },{ "tor",1 },{ "org",1 },{ "zlo",1 },
  { "lot",2 },{ "vlo",1 },{ "lok",1 },{ "mel",1 },{ "ele",2 },{ "led",1 },
  { "ara",3 },{ "rak",5 },{ "xar",1 },{ "ult",1 },{ "lta",1 },{ "tag",1 },
  { "shi",2 },{ "hie",2 },{ "iel",2 },{ "tra",1 },{ "ras",1 },{ "ast",2 },
  { "tre",1 },{ "rel",1 },{ "elk",1 },{ "yov",1 },{ "ovo",1 },{ "vok",1 },
  { "loo",1 },{ "oou",1 },{ "oum",1 },{ "miy",1 },{ "iye",2 },{ "yel",1 },
  { "loc",1 },{ "oct",1 },{ "cta",1 },{ "mal",1 },{ "all",1 },{ "lle",1 },
  { "lek",1 },{ "dam",1 },{ "ams",1 },{ "msa",1 },{ "sak",1 },{ "rez",1 },
  { "ezr",1 },{ "zra",1 },{ "mul",2 },{ "ull",4 },{ "lla",4 },{ "lak",3 },
  { "kun",1 },{ "und",1 },{ "nda",2 },{ "dar",2 },{ "del",1 },{ "elw",1 },
  { "lwa",1 },{ "war",1 },{ "gor",2 },{ "ora",1 },{ "rat",1 },{ "ath",1 },
  { "bal",1 },{ "alo",1 },{ "oth",1 },{ "tol",2 },{ "loa",1 },{ "lac",1 },
  { "ach",1 },{ "xam",1 },{ "ama",1 },{ "mas",1 },{ "dhi",1 },{ "ell",1 },
  { "lal",1 },{ "ali",1 },{ "tha",2 },{ "haz",1 },{ "aza",1 },{ "zat",1 },
  { "mne",1 },{ "nel",1 },{ "len",1 },{ "sha",1 },{ "har",1 },{ "hyu",1 },
  { "yur",1 },{ "ura",1 },{ "has",1 },{ "sti",1 },{ "liu",1 },{ "iuv",1 },
  { "uve",1 },{ "vet",1 },{ "olm",1 },{ "lmi",1 },{ "min",1 },{ "ing",1 },
  { "lan",1 },{ "ang",1 },{ "yav",1 },{ "avo",1 },{ "von",1 },{ "onn",1 },
  { "ill",1 },{ "llu",1 },{ "luv",1 },{ "uva",1 },{ "vat",1 },{ "eil",1 },
  { "ilp",1 },{ "esh",2 },{ "lpt",1 },{ "pto",1 },{ "tog",1 },{ "bin",1 },
  { "int",1 },{ "ntu",1 },{ "tue",1 },{ "uek",1 },{ "gre",1 },{ "rem",1 },
  { "eml",1 },{ "mla",1 },{ "alk",1 },{ "lko",1 },{ "kor",1 },{ "ork",1 },
  { "rkh",1 },{ "lad",1 },{ "adi",1 },{ "din",1 },{ "olb",1 },{ "lbo",1 },
  { "bon",1 },{ "ona",1 },{ "nar",1 },{ "thi",1 },{ "hiy",1 },{ "yer",1 },
  { "eru",1 },{ "rug",1 },{ "yes",1 },{ "hin",1 },{ "ind",1 },{ "hye",1 },
  { "yen",1 },{ "enn",1 },{ "nni",1 },{ "nig",1 },{ "igo",1 },{ "rwe",1 },
  { "wen",1 },{ "end",1 },{ "ndl",1 },{ "dla",1 },{ "akh",1 },{ "thr",1 },
  { "hre",1 },{ "res",1 },{ "shl",1 },{ "hlo",1 },{ "log",1 },{ "oga",1 },
  { "gar",1 },{ "arr",1 },{  NULL,0 } },

  { 32,58,71,84,96,100 },
  { 2,7,12,12,14,25,25,28,36,42,52,58,58,69,86,98,98,98,99,100 },
  { {	NULL,	NULL,	FALSE } } }


};

/* The purpose of this function is to pre-process the language pairs */
/* and triplets into easy lookup values during MUD bootup, to allow  */
/* fast access during the running of translate_word.  -- Aeolis      */
void language_preproc( )
{
    int i, j, k;

    for (i = 0; i < MAX_LANGUAGE; i++)
    {
	for (j = 0; lang_data[i].pairs[j].letters; j++)
	{
	    lang_pair_data[i][j] = 0;
	    for (k = 0; k < 2; k++)
		if (IS_VOWEL(lang_data[i].pairs[j].letters[k]))
		    lang_pair_data[i][j] += (2 >> k);
	}
	
	for (j = 0; lang_data[i].triplets[j].letters; j++)
	{
	    lang_trip_data[i][j] = 0;
	    for (k = 0; k < 3; k++)
		if (IS_VOWEL(lang_data[i].triplets[j].letters[k]))
		    lang_trip_data[i][j] += (4 >> k);
	}

        lang_dict[i] = new_dict();
	for (j = 0; j < MAX_LDICT; j++)
	{
	    if (lang_data[i].dict_data[j].word)
	        dict_insert(lang_dict[i], lang_data[i].dict_data[j].word, (void *) &lang_data[i].dict_data[j]);
	    else
		break;
	}
    }

    return;
}

static int language_skill(CHAR_DATA & ch, int lang_num)
{
    // Determine language skill; IMMs and mobs with the appropriate bit set are automatic masters
    if (IS_IMMORTAL(&ch) || (IS_NPC(&ch) && IS_SET(ch.lang_flags, (1 << lang_num)))) 
        return 100;
    
    return get_skill(&ch, *lang_data[lang_num].sn);
}

void do_languages(CHAR_DATA *ch, char *argument)
{
    int i;
    char buf[MAX_STRING_LENGTH];
    bool second_entry = FALSE;
    
    for (i = 0; i < MAX_LANGUAGE; i++)
    {
	if ((!IS_NPC(ch) && (ch->pcdata->learned[*lang_data[i].sn] > 0))
	 || (IS_NPC(ch) && IS_SET(ch->lang_flags, (1 << i))))
	{
	    sprintf(buf, "%-20s%d%%", lang_data[i].name, IS_NPC(ch) ? 100 : ch->pcdata->learned[*lang_data[i].sn]);
	    sprintf(buf, "%-37s", buf);
	    if (second_entry)
	    {
		sprintf(buf, "%s\n\r", buf);
		second_entry = FALSE;
	    }
	    else
		second_entry = TRUE;
	    send_to_char(buf, ch);
	}
    }
  
    if (second_entry)
        send_to_char("\n\r", ch);
}

void do_speak(CHAR_DATA *ch, char *argument)
{
    char buf[MAX_STRING_LENGTH];
    int i;

    if (argument[0] == '\0')
    {
	sprintf(buf, "You are currently speaking %s.\n\r", lang_data[ch->speaking].name);
	send_to_char(buf, ch);
	return;
    }

    for (i = 0; i < MAX_LANGUAGE; ++i)
    {
        if (!str_prefix(argument, lang_data[i].name) && language_skill(*ch, i) > 0)
        {
            sprintf(buf, "You begin speaking %s.\n\r", lang_data[i].name);
            send_to_char(buf, ch);
            ch->speaking = i;
            return;
        }
    }

    send_to_char("Invalid language.   You are able to speak the following languages:\n\r", ch);
    do_languages(ch, "");
}

int translate_word( char *word, char *tostr, int language )
{
    char buf[MAX_STRING_LENGTH];
    char *sc; 
#ifndef WIN32
    char*oldrand, newrand[MAX_INPUT_LENGTH];
#endif
    int wlen = 0, i, j = 0, k, newlen, flen = 0, lval, nc, tfreq, l, pval;
    int cp = 0, tdone;
    unsigned int seed;
    bool found_trip;
    LDICT_DATA *ld;

    ld = (LDICT_DATA *) dict_lookup(lang_dict[language], word);
  
    if (ld && !ld->coll)
    {
	for (i = 0; ld->replace[i] != '\0'; i++)
	    tostr[cp++] = ld->replace[i];
	return cp;
    }

    sc = word;
    seed = 0;
    while ((UPPER(*sc) >= 65) && (UPPER(*sc) <= 90))
    {
        seed = (seed * 26) + ((UPPER(*sc) - 64) % (UINT_MAX - 1)) + 1;
	sc++;
	wlen++;
    }
    seed += language;

#if defined(WIN32)
    srand(seed);
#else
    oldrand = initstate(seed, newrand, 256);
#endif

    // Step 2: Determinte length of new word.
    if (lang_data[language].rough)
        i = (random() % 11) + 5;
    else
    {
	if (lang_data[language].long_words)
            i = (random() % 10) + 8;
	else
	{
            if ((random() % 5) < 2) 
                i = (random() % 5) + 5;
	    else
                i = (random() % 5) + 10;
	}
    }
    if (i > 10)
        newlen = UMAX(1, ((wlen * i) - 5) / 10);
    else if (i < 10)
	newlen = UMAX(1, ((wlen * i) + 4) / 10);
    else
	newlen = UMAX(1, (wlen * i) / 10);

    // Step 3: Determine number of divisions
    tdone = 0;
    while (tdone < newlen)
    {
	if (lang_data[language].rough)
	{
            flen = (((newlen - tdone) > 4) && ((random() % 2) == 0))
                 ? UMIN(MAX_CONSTRAINT, (random() % 3) + 2) 
	         : UMIN(MAX_CONSTRAINT, (newlen - tdone));
	}
        else
	    flen = UMIN(MAX_CONSTRAINT, (newlen - tdone));

	if (lang_data[language].rough && (flen == 2) && (flen != newlen) && lang_data[language].pairs[0].letters
         && ((random() % 2) == 0))
	{
	    for (k = 0, nc = 0; k < MAX_LPAIRS; k++)
	    {
		nc += lang_data[language].pairs[k].freq;
		if (lang_data[language].pairs[k].letters == NULL)
		    break;
	    }
                    i = (random() % nc);
	    nc = 0;
	    for (k = 0; k < MAX_LPAIRS; k++)
		if (i < (lang_data[language].pairs[k].freq + nc))
		{
	    	    for (j = 0; j < 2; j++)
		    if (!cp && IS_UPPER(*word))
			tostr[cp++] = UPPER(lang_data[language].pairs[k].letters[j]);
		    else			
			tostr[cp++] = lang_data[language].pairs[k].letters[j];
		    break;
		}
	        else
		    nc += lang_data[language].pairs[k].freq;

	    tdone += flen;
	    continue;
	}		    
		
	if (lang_data[language].rough && (flen == 3) && (flen != newlen) && lang_data[language].triplets[0].letters
         && ((random() % 3) == 0))
	{
	    for (k = 0, nc = 0; k < MAX_LTRIPS; k++)
	    {
		nc += lang_data[language].triplets[k].freq;
		if (lang_data[language].triplets[k].letters == NULL)
		    break;
	    }
                    i = (random() % nc);
	    nc = 0;
	    for (k = 0; k < MAX_LTRIPS; k++)
		if (i < (lang_data[language].triplets[k].freq + nc))
		{
	    	    for (j = 0; j < 3; j++)
		    if (!cp && IS_UPPER(*word))
			tostr[cp++] = UPPER(lang_data[language].triplets[k].letters[j]);
		    else			    
			tostr[cp++] = lang_data[language].triplets[k].letters[j];
		    break;
		}
	        else
		    nc += lang_data[language].triplets[k].freq;

	    tdone += flen;
	    continue;
	}

        // Step 4: Pick a constraint
        j = 0;
        for (i = 0; i < MAX_NUMPERCONS; i++)
	    if (lang_data[language].cons[flen-1][i] != NULL)
	        j++;
	    else
		break;

	if (j)
            i = (random() % j);
	else
	{
	    sprintf(buf, "translate_spoken: language %d, no constraints for length %d\n\r", language, flen);
	    bug(buf, 0);
	    exit(1);
	}
    
        // Step 5: Choose letters
	j = 0;
	while (lang_data[language].cons[flen-1][i][j] != '\0')
        {
	    nc = 0;
	    if (lang_data[language].cons[flen-1][i][j] == '(')
	    {
		j++;
		for (k = 0; lang_data[language].cons[flen-1][i][j+k] != ')'; k++)
		{
		    nc++;
		    if (lang_data[language].cons[flen-1][i][j+k] == '\0')
		    {
			sprintf(buf, "translate_spoken: language %d, ( without ) in constraint length %d number %d",
				language, flen, i);
			bug(buf, 0);
			exit(1);
		    }
		}
                k = (random() % nc);
		j += k;
	    }

	    if (!lang_data[language].rough && ((lang_data[language].cons[flen-1][i][j] == '+') || (lang_data[language].cons[flen-1][i][j] == '-')) && !nc)
	    {
                if (((flen - j) >= 2) && lang_data[language].pairs[0].letters && ((lang_data[language].cons[flen-1][i][j+1] == '-') || (lang_data[language].cons[flen-1][i][j+1] == '+')) && ((random() % 2) == 0))
		{
		    found_trip = FALSE;

                    if (((flen - j) >= 3) && lang_data[language].triplets[0].letters && ((lang_data[language].cons[flen-1][i][j+2] == '-') || (lang_data[language].cons[flen-1][i][j+2] == '+')) && ((random() % 2) == 0))
		    {
		        pval = 0;
		        for (k = 0; k < 3; k++)
			    if (lang_data[language].cons[flen-1][i][j+k] == '-')
			        pval += (4 >> k);

			tfreq = 0;
			for (k = 0; lang_data[language].triplets[k].letters; k++)
			    if (lang_trip_data[language][k] == pval)
			        tfreq += lang_data[language].triplets[k].freq;

			if (tfreq > 0)
			{
			    found_trip = TRUE;
                            lval = (random() % tfreq);
			    for (k = 0; k < MAX_LTRIPS; k++)
			        if (lang_trip_data[language][k] == pval)
			        {
				    lval -= lang_data[language].triplets[k].freq;
				    if (lval < 0)
				    {
				        for (l = 0; l < 3; l++)
				        {		
				 	    if (!cp && IS_UPPER(*word))		
					        tostr[cp++] = UPPER(lang_data[language].triplets[k].letters[l]);
					    else
					        tostr[cp++] = lang_data[language].triplets[k].letters[l];
					}
					j += 3;
					break;
				    }
				} 
			}
		    }

		    if (!found_trip)
		    {   
			pval = 0;
			for (k = 0; k < 2; k++)
			    if (lang_data[language].cons[flen-1][i][j+k] == '-')
			        pval += (2 >> k);

			tfreq = 0;
			for (k = 0; lang_data[language].pairs[k].letters; k++)
			    if (lang_pair_data[language][k] == pval)
			        tfreq += lang_data[language].pairs[k].freq;

			if (tfreq > 0)
			{
                            lval = (random() % tfreq);
			    for (k = 0; k < MAX_LPAIRS; k++)
			        if (lang_pair_data[language][k] == pval)
			        {
				    lval -= lang_data[language].pairs[k].freq;
				    if (lval < 0)
				    {
				        for (l = 0; l < 2; l++)
				        {		
				    	    if (!cp && IS_UPPER(*word))		
					        tostr[cp++] = UPPER(lang_data[language].pairs[k].letters[l]);
					    else
					        tostr[cp++] = lang_data[language].pairs[k].letters[l];
					}
				        j += 2;
				        break;
				    }
				}
			    continue;
			}
		    }
		    else
			continue;
		}
	    }


	    switch (lang_data[language].cons[flen-1][i][j])
	    {
		case '\0':
		    sprintf(buf, "translate_spoken: language %d, constraint length %d only contains %d characters",
			language, flen, j);
		    bug(buf, 0);
		    break;
		case '*':
                    k = (random() % 27);
		    if (k < 6)
		    {
                        lval = (random() % 100);
	        	for (k = 0; k < 6; k++)
		            if (lval < lang_data[language].vowel_freq[k])
		            {
				if (!cp && IS_UPPER(*word))
				    tostr[cp++] = UPPER(vowel_table[k]);
				else
			            tostr[cp++] = vowel_table[k];
				break;
			    }
		    }
		    else
		    {
                        lval = (random() % 100);
			for (k = 0; k < 21; k++)
		            if (lval < lang_data[language].consonant_freq[k])
		            {
				if (!cp && IS_UPPER(*word))
			            tostr[cp++] = UPPER(consonant_table[k]);
				else
				    tostr[cp++] = consonant_table[k];
				break;
		            }
		    }
		    break;
	        case '-':
                    lval = (random() % FREQ_TOTAL);
	            for (k = 0; k < 6; k++)
		        if (lval < lang_data[language].vowel_freq[k])
		        {
			    if (!cp && IS_UPPER(*word))
				tostr[cp++] = UPPER(vowel_table[k]);
			    else
			        tostr[cp++] = vowel_table[k];
			    break;
		        }
		    break;
	        case '+':
                    lval = (random() % FREQ_TOTAL);
		    for (k = 0; k < 21; k++)
		        if (lval < lang_data[language].consonant_freq[k])
		        {
			    if (!cp && IS_UPPER(*word))
			        tostr[cp++] = UPPER(consonant_table[k]);
			    else
				tostr[cp++] = consonant_table[k];
			    break;
		        }
		    break;
	        default:
		    if (!cp && IS_UPPER(*word))
			tostr[cp++] = UPPER(lang_data[language].cons[flen-1][i][j]);
		    else
			tostr[cp++] = lang_data[language].cons[flen-1][i][j];
		    break;
	    }
	    j++;
	    if (nc > 0)
	    {
		while (lang_data[language].cons[flen-1][i][j] != ')')
		    j++;
		j++;
	    }
        }
	tdone += flen;
    }

#ifndef WIN32
    setstate(oldrand);
#endif
    return newlen;
}

char *translate_out_new(CHAR_DATA *ch, LANG_STRING* lang_in)
{
    int curword = 0, i = 0, lo = 0;
    char buf[MAX_STRING_LENGTH];

    // If a master of the language, just return the string undoctored
    if (lang_in->ptrans == MAX_LANGUAGE || (lang_in->ptrans >= 0 && language_skill(*ch, lang_in->ptrans) >= 100))
        return lang_in->orig_string;

    memset((void *) lstr_out, 0, MAX_STRING_LENGTH);
    for (i = 0; (UPPER(lang_in->orig_string[i]) < 'A') || (UPPER(lang_in->orig_string[i]) > 'Z'); i++)
    {
        lstr_out[lo++] = lang_in->orig_string[i];
        if (lang_in->orig_string[i] == '\0')
            return lstr_out;
    }

    while (lang_in->word[curword].len > 0)
    {
	if (lang_in->word[curword].coll)
	{
	    if (number_percent() > language_skill(*ch, lang_in->word[curword].lang))
	        lo = translate_word(lang_in->word[curword].coll->replace, &lstr_out[lo], lang_in->word[curword].lang) + lo;
	    else
	    {
            for (i = 0; lang_in->word[curword].coll->replace[i] != '\0'; i++)
                lstr_out[lo++] = lang_in->word[curword].coll->replace[i];
	    }
	}
	else if (lang_in->word[curword].lang < 0)
	{
	    for (i = 0; ((UPPER(lang_in->orig_string[lang_in->word[curword].start + i]) >= 65)
		&& (UPPER(lang_in->orig_string[lang_in->word[curword].start + i]) <= 90)); i++)
	    {
		if (number_bits(1) == 0)
		{
		    if (IS_UPPER(lang_in->orig_string[lang_in->word[curword].start + i]))
			buf[i] = number_range(65, 90);
		    else
		        buf[i] = number_range(97, 122);
		}
		else
		    buf[i] = lang_in->orig_string[lang_in->word[curword].start + i];
	    }
	    buf[i] = '\0';
	    
	    lo = translate_word(buf, &lstr_out[lo], ((lang_in->word[curword].lang * -1) - 1)) + lo;
	}
	else if (number_percent() > language_skill(*ch, lang_in->word[curword].lang))
	    lo = translate_word(&lang_in->orig_string[lang_in->word[curword].start], &lstr_out[lo], lang_in->word[curword].lang) + lo;
	else
	    for (i = 0; i < lang_in->word[curword].len; i++)
		lstr_out[lo++] = lang_in->orig_string[lang_in->word[curword].start + i];

	for (i = 0; ((UPPER(lang_in->orig_string[lang_in->word[curword].start + lang_in->word[curword].len + i]) < 65)
           || (UPPER(lang_in->orig_string[lang_in->word[curword].start + lang_in->word[curword].len + i]) > 90)); i++)
 	{
	    lstr_out[lo++] = lang_in->orig_string[lang_in->word[curword].start + lang_in->word[curword].len + i];
	    if (lang_in->orig_string[lang_in->word[curword].start + lang_in->word[curword].len + i] == '\0')
		break;
	}

	curword++;

    }

    return lstr_out;
};
	
		
LANG_STRING* translate_spoken_new(CHAR_DATA *ch, char *instr)
{
    LANG_STRING *lang_out = (LANG_STRING*)malloc(sizeof(LANG_STRING));
	memset(lang_out, 0, sizeof(LANG_STRING));
    LDICT_DATA *ld;
    char *word, *sp;
    int cp = 0, nwdone = 0, en;
    bool did_trans = FALSE;

    sp = instr;
    
    if (IS_IMMORTAL(ch))
	lang_out->ptrans = MAX_LANGUAGE;
    else
        lang_out->ptrans = ch->speaking;

    if (IS_NPC(ch) && IS_SET(ch->nact, ACT_OMNILINGUAL))
    {
	strcpy(lang_out->full_trans, instr);
	lang_out->ptrans = MAX_LANGUAGE;
	return lang_out;
    }

    lang_out->word[nwdone].coll = NULL;
    lang_out->word[nwdone].start = 0;
    lang_out->word[nwdone].len = 0;

    while ((UPPER(*sp) < 'A') || (UPPER(*sp) > 'Z'))
    {
	lang_out->word[nwdone].start++;
	lang_out->full_trans[cp++] = *sp;
	if (*sp == '\0')
	    return lang_out;
	sp++;
    }

    word = sp;

    int skill(language_skill(*ch, ch->speaking));
    while ( *sp != '\0' )
    {
	sp++;
	lang_out->word[nwdone].len++;
	if ((UPPER(*sp) < 'A') || (UPPER(*sp) > 'Z'))
	{
	    lang_out->word[nwdone].lang = ch->speaking;
	    if (number_percent() > skill)
        {
            lang_out->ptrans = -1;

            if ((ld = (LDICT_DATA *) dict_lookup(lang_dict[ch->speaking], word)) != NULL)
            {
                if (ld->coll && (number_bits(1) == 0))
                    lang_out->word[nwdone].coll = ld;
            }

            if (!lang_out->word[nwdone].coll)
            {
                if (nwdone > 0)
                    en = number_range(1, 3);
                else
                    en = number_range(1, 2);
                switch (en)
                {
                    case 2:
                        lang_out->word[nwdone].lang = race_table[ch->race].native_tongue;
                        break;
                    case 3:
                        lang_out->word[nwdone].lang = (ch->speaking * -1) - 1;
                        break;
                    case 4:
                        lang_out->word[nwdone + 1].start = lang_out->word[nwdone].start;
                        lang_out->word[nwdone + 1].len = lang_out->word[nwdone].len;
                        lang_out->word[nwdone].start = lang_out->word[nwdone-1].start;
                        lang_out->word[nwdone].len = lang_out->word[nwdone-1].len;
                        lang_out->word[nwdone].lang = lang_out->word[nwdone-1].lang;
                        lang_out->word[nwdone-1].start = lang_out->word[nwdone + 1].start;
                        lang_out->word[nwdone-1].len = lang_out->word[nwdone + 1].len;
                        lang_out->word[nwdone-1].lang = ch->speaking;
                        did_trans = TRUE;
                        break;
                }
            }
        }
	    else
            lang_out->word[nwdone].lang = ch->speaking;

	    nwdone++;
	    lang_out->word[nwdone].coll = NULL;
	    lang_out->word[nwdone].start = lang_out->word[nwdone-1-did_trans].start + lang_out->word[nwdone-1-did_trans].len;
	    did_trans = FALSE;

	    cp += translate_word(word, &lang_out->full_trans[cp], ch->speaking);

	    while ((UPPER(*sp) < 'A') || (UPPER(*sp) > 'Z'))
	    {
	        lang_out->full_trans[cp++] = *sp;
		if ( *sp == '\0' )
		    break;
		lang_out->word[nwdone].start += 1;
		sp++;
	    }
	    lang_out->word[nwdone].len = 0;
	    word = sp;
	}

    }

    return lang_out;
};
